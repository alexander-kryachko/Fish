<modification>
    <id>additional fix</id>
    <version>1.0</version>
    <vqmver>1.0.8</vqmver>
    <author>max</author>

    <file name="catalog/view/theme/*/template/module/cart.tpl">
        <operation>
            <search position="replace"><![CDATA[<a href="<?php echo $checkout; ?>" class="button"></a>]]></search>
            <add><![CDATA[
            <a class="button-continue" onclick="$('#cart').removeClass('active');">Продолжить покупки</a>
            <a href="<?php echo $checkout; ?>" class="button"></a>
            ]]></add>
        </operation>
    </file>

    <file name="catalog/view/theme/*/template/product/product.tpl">

        <operation>
            <search position="replace"><![CDATA[value="Купить" id="button-cart"]]></search>
            <add><![CDATA[ value="<?php echo ($is_master)?"Выбрать модель":"Купить"; ?>" id="button-cart"]]></add>
        </operation>
<!--
        <operation>
            <search position="before"><![CDATA[<?php if ($price) {]]></search>
            <add><![CDATA[
            <?php
            if($price && $special) {
                $diff= 100*(float)$price / (float)$special - 100; //- на столько процентов старая цена больше новой
            } else {
                $diff = 0;
            } ?>
            ]]></add>
        </operation>

        <operation>
            <search position="before"><![CDATA[echo '<span class="new-price">'.$priceStr.'</span>';]]></search>
            <add><![CDATA[
                //$diff= 100*$oldmin / $min - 100; //- на столько процентов старая цена больше новой
                if( $diff > 10  ){ //условие 10 %
            ]]></add>
        </operation>

        <operation>
            <search position="after"><![CDATA[echo '&nbsp;<del class="old-price">&nbsp;'.$oldpriceStr.'&nbsp;</del>';]]></search>
            <add><![CDATA[
                } else {
                    echo '<span style="color: #008A9B;" class="new-price">'.$priceStr.'</span>';
                }
            ]]></add>
        </operation>

        <operation>
            <search position="before"><![CDATA[<p itemprop="price" class="new-price"]]></search>
            <add><![CDATA[<?php if ($diff > 10){ ?>]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[<? if ($price != $special]]></search>
            <add><![CDATA[
                <?php } else { ?>
                <p itemprop="price" style="color: #008A9B;" class="new-price"><?php echo $special; ?></p>
                <?php } ?>
            ]]></add>
        </operation>

        <operation>
            <search position="before"><![CDATA[($p['special'] && round($p['price']) != round($pds_price))]]></search>
            <add><![CDATA[
            if($p['price'] && $p['special']) {
                $model_diff = 100*(float)$p['price'] / (float)$p['special'] - 100; //- на столько процентов старая цена больше новой
            } else {
                $model_diff = 0;
            }
            ]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[($p['special'] && round($p['price']) != round($pds_price))]]></search>
            <add><![CDATA[($p['special'] && round($p['price']) != round($pds_price) && $model_diff > 10 )]]></add>
        </operation>
-->

        <operation>
            <search position="before"><![CDATA[<div class="haract">]]></search>
            <add><![CDATA[
                    <?php if($p['quantity']  > 6661400 && $p['quantity'] < 6661489 ) { ?>
                        <span class="stock" >Под заказ (3-5 дней)</span>
                    <?php } elseif($p['quantity'] > 0 ) { ?>
                        <span class="stock" >Есть в наличии</span>
                    <?php } ?>
            ]]></add>
        </operation>


        <!-- promotion -->
        <operation>
            <search position="before"><![CDATA[<? if (!empty($p['discounts']) && $available){ ?>]]></search>
            <add><![CDATA[
                <span class="promotion"><?php echo($p['promotion']); ?></span>
            ]]></add>
        </operation>
        <!-- promotion -->

    </file>

    <file name="catalog/view/theme/*/template/module/ajax_viewed_product.tpl">
        <!--
        <operation>
            <search position="before"><![CDATA[<?php if ($product['thumb']) { ?>]]></search>
            <add><![CDATA[
              <?php
              if($product['price'] && $product['special']) {
                $model_diff = 100*(float)$product['price'] / (float)$product['special'] - 100; //- на столько процентов старая цена больше новой
              } else {
                $model_diff = 0;
              } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[<span class="price-old">]]></search>
            <add><![CDATA[
              <?php if($model_diff > 10) { ?>
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[<span class="price-old">]]></search>
            <add><![CDATA[
              <?php } else { ?>
                <span class="price-new"><?php echo $product['special']; ?></span>
              <?php } ?>
            ]]></add>
        </operation>
        -->

    </file>

    <file name="catalog/view/theme/*/template/product/search.tpl">
<!--
        <operation>
            <search position="before"><![CDATA[<div class="price">]]></search>
            <add><![CDATA[
            <?php
            if($product['price'] && $product['special']) {
                $diff = 100*(float)$product['price'] / (float)$product['special'] - 100; //- на столько процентов старая цена больше новой
            } else {
                $diff = 0;
            } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[<span class="price-old"><?php echo $product['price']; ?></span><br/>]]></search>
            <add><![CDATA[
                <?php if( $diff > 10  ) { //условие 10 % ?>
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[<span class="price-old"><?php echo $product['price']; ?></span><br/>]]></search>
            <add><![CDATA[
                <?php } ?>
            ]]></add>
        </operation>
        -->
    </file>

    <!-- promotion -->
    <file name="catalog/model/catalog/product.php">
        <operation>
            <search position="before"><![CDATA[. " p.model, "]]></search>
            <add><![CDATA[
               . " prom.name as promotion, "
               ]]></add>
        </operation>

        <operation>
            <search position="before"><![CDATA[. " WHERE (pm.master_product_id = " . (int)$master_product_id . ") "]]></search>
            <add><![CDATA[
                    . " LEFT JOIN " . DB_PREFIX . "product_promotion prpr "
                    . " ON prpr.product_id = p.product_id "
                    . " LEFT JOIN " . DB_PREFIX . "promotion prom "
                    . " ON prom.promotion_id = prpr.promotion_id "
               ]]></add>
        </operation>
    </file>

    <file name="catalog/controller/product/product.php">
        <operation>
            <search position="after"><![CDATA['discounts' => $pds_discounts_data,]]></search>
            <add><![CDATA[
            'promotion' => empty($result['promotion'])?'':$result['promotion'],
            ]]></add>
        </operation>
    </file>
    <!-- promotion -->


   <!--
   <file name="">
        <operation>
            <search position="after"><![CDATA[]]></search>
            <add><![CDATA[
            ]]></add>
        </operation>
    </file>
	-->
</modification>